---
title: DHCP+FTP网络服务
date: 2020-07-02 20:54:31
tags:
---
##### 请描述通过DHCP服务器获取IP地址的过程

###### DHCP租约过程分为四部曲：

1. 客户机请求IP（客户机发DHCPDISCOVER广播包）
1. 服务器响应（服务器发DHCPOFFER广播包）
1. 客户机选择IP（客户机发DHCPREQUEST广播包）
1. 服务器确定租约（服务器发DHCPACK/DHCPNAK广播包）
<!-- more -->
###### DHCP续租两部曲：

1. 客户机续租IP（客户机发DHCPREQUEST）
1. 服务器确定租约/不续（服务器发DHCPACK/DHCPNAK）


###### DHCP租用失败：

- 如果DHCP客户机无法找到DHCP服务器，它将从TCP/IP的B类网段169.254.0.0/16中挑选一个IP地址作为自己的临时IP地址，继续每隔5分钟尝试与DHCP服务器进行通讯，一旦与DHCP服务器取得联系，则客户机放弃自动配置的临时IP地址，而使用DHCP服务器分配的IP地址

- DHCP客户机收到DHCP服务器回应的ACK报文后，通过地址冲突检测（arp）发现服务器分配的地址冲突或者由于其他原因导致不能使用，则发送DECLINE报文，通知服务器所分配的IP地址不可用

##### 简单描述FTP的主动模式和被动模式的区别？

- 主动模式

> FTP客户端从任意的非特殊的端口（N>1023）连入到FTP服务器的命令端口--21端口。然后客户端在N+1（N+1 >= 1024）端口监听，并且通过N+1（N+1>=1024）端口发送命令给FTP服务器。服务器会反过来连接用户本地指定的数据端口，比如20端口。
> 
> 主动模式的FTP的主要问题实际上落在客户端。FTP的客户端并不会主动连接到服务器的数据端口，而是是告诉服务器它正在监听哪个端口，然后服务器发起连接到客户端上指定的端口。但是，这样的连接有时候会被客户端的防火墙阻止。

- 被动模式

> 为了解决服务器主动发起到客户端连接会被阻止的问题，另一种更完善的工作模式出现了，它就是 FTP 的被动模式，缩写作 PASV，它工作的前提是客户端明确告知 FTP 服务器它使用被动模式。
> 
> 
> 在被动模式的 FTP 中，客户端启动到服务器的两个连接，解决了防火墙阻止从服务器到客户端的传入数据端口连接的问题。FTP 连接建立后，客户端在本地打开两个随机的非系统端口 N 和 N + 1(N > 1023)。第一个端口连接服务器上的 21 端口，但是客户端这次将会发出 PASV 命令，也就是不允许服务器连接回其数据端口。这样，服务器随后会打开一个随机的非系统端口 P (P > 1023)，并将 P 发送给客户端作为 PASV 命令的响应。然后客户端启动从端口 N+1 到端口 P 的连接来传输数据

