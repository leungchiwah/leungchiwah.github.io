---
title: SSH网络服务
date: 2020-07-05 16:55:05
tags:
---
###### 哪些设置能够提升SSH远程管理的安全等级？

- 登录验证模式修改为密钥登录
- 登录端口修改为非22端口以及制定监听IP
- 禁止root用户远程登录
- 设置无操作时自动断开连接
- 设置登录失败后登录尝试次数为3次
- 编写防火墙规则，使用白名单机制放行ssh服务的监听端口
<!-- more -->
类似面试题
###### ssh连接时认证时间过长如何解决？

配置文件：/etc/ssh/sshd_config


UseDNS no | #取消ssh登录时的dns反向解析请求功能
---|---




###### scp和rsync进行远程文件复制有什么区别？

~ | ~ | ~ | ~ | ~ | 
---|---|---|---|---|
scp | 全量备份| 文件级传输 | 加密传输 | 资源消耗低
rsync | 差异对比，增量备份 | 分块校验，部分传输 | 非加密传输 | 资源消耗高

---


## ssh的登录验证方式

#### 用户口令

1. 客户端向服务端发起ssh请求
1. 服务端收到请求，发送公钥给客户端
1. 客户端输入用户名密码通过公钥加密回传给服务端
1. 服务端通过私钥解密得到用户名密码和本地进行对比，验证成功，允许登录，否则再次验证

#### 秘钥对登录

1. 首先在客户端上生成一对秘钥
1. 将公钥拷贝给服务端一份并重命名为authorized_keys
1. 客户端向服务端发送一个连接请求，信息包括IP、用户名
1. 服务端得到客户端的信息后，会到authorized_keys中查找，如果有相应的IP和用户名，服务端会随机生成一个字符串（质疑码）。
1. 服务端将使用公钥对字符串（质疑码）进行加密，发送给客户端
1. 客户端得到服务端发来的消息后，客户端会使用私钥进行解密，然后将解密后的字符串（质疑码）发送给服务端
1. 服务端接收到解密后的字符串会跟先前生成的字符串进行对比，如果一致，就允许客户端免密码登录


## ssh的登录端口和监听设置

###### 配置文件：/etc/ssh/sshd_config

~ | ~
---|---
 #Port 22| #ssh服务默认监听的端口
#ListenAddress 0.0.0.0 | #ssh服务默认监听的IP地址

==生产环境中只监听内网网卡的IP地址==

## ssh的登录用户限制

###### 配置文件：/etc/ssh/sshd_config

#PermitRootLogin yes | #是否允许root用户使用ssh登录
---|-

==不建议使用root用户远程登录==

## ssh的登录超时设置

配置文件：/etc/profile


export TMOUT=300 | #设置客户端5分钟无操作自动断开连接
---|---

连接时不操作，自动断开

## ssh登录失败尝试次数

###### 配置文件：/etc/ssh/sshd_config

#MaxAuthTries 6 | #设置客户端登录失败尝试次数为6次
---|---

预防暴力破解
